apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  annotations:
    pipelines.kubeflow.org/v2_pipeline: "true"
    tekton.dev/artifact_bucket: mlpipeline
    tekton.dev/artifact_endpoint: minio-service.kubeflow:9000
    tekton.dev/artifact_endpoint_scheme: http://
  creationTimestamp: null
  generateName: hello-world-
  labels:
    pipelines.kubeflow.org/v2_component: "true"
spec:
  pipelineSpec:
    tasks:
    - name: hello-world-driver
      params:
      - name: type
        value: CONTAINER
      - name: pipeline_name
        value: namespace/n1/pipeline/hello-world
      - name: run_id
        value: $(context.pipelineRun.uid)
      - name: dag_execution_id
        value: $(tasks.root-system-dag-driver.results.execution-id)
      - name: component
        value: '{"executorLabel":"exec-hello-world","inputDefinitions":{"parameters":{"text":{"type":"STRING"}}}}'
      - name: task
        value: '{"cachingOptions":{"enableCache":true},"componentRef":{"name":"comp-hello-world"},"inputs":{"parameters":{"text":{"componentInputParameter":"text"}}},"taskInfo":{"name":"hello-world"}}'
      - name: container
        value: '{"args":["--text","{{$.inputs.parameters[''text'']}}"],"command":["sh","-ec","program_path=$(mktemp)\nprintf
          \"%s\" \"$0\" \u003e \"$program_path\"\npython3 -u \"$program_path\" \"$@\"\n","def
          hello_world(text):\n    print(text)\n    return text\n\nimport argparse\n_parser
          = argparse.ArgumentParser(prog=''Hello world'', description='''')\n_parser.add_argument(\"--text\",
          dest=\"text\", type=str, required=True, default=argparse.SUPPRESS)\n_parsed_args
          = vars(_parser.parse_args())\n\n_outputs = hello_world(**_parsed_args)\n"],"image":"python:3.7"}'
      - name: iteration_index
        value: ""
      taskRef:
        apiVersion: kfp-driver.tekton.dev/v1alpha1
        kind: KFPDriver
        name: kfp-driver
    - name: hello-world
      params:
      - name: executor-input
        value: $(tasks.hello-world-driver.results.executor-input)
      - name: execution-id
        value: $(tasks.hello-world-driver.results.execution-id)
      - name: run-id
        value: $(context.pipelineRun.uid)
      - name: component-spec
        value: '{"executorLabel":"exec-hello-world","inputDefinitions":{"parameters":{"text":{"type":"STRING"}}}}'
      taskSpec:
        metadata:
          annotations:
            pipelines.kubeflow.org/v2_pipeline: "true"
          labels:
            pipelines.kubeflow.org/v2_component: "true"
        params:
        - name: executor-input
          type: string
        - name: execution-id
          type: string
        - name: run-id
          type: string
        - name: component-spec
          type: string
        spec: null
        steps:
        - command:
          - launcher-v2
          - --copy
          - /tekton/home/launch
          image: gcr.io/ml-pipeline-test/dev/kfp-launcher-v2@sha256:4513cf5c10c252d94f383ce51a890514799c200795e3de5e90f91b98b2e2f959
          imagePullPolicy: Always
          name: kfp-launcher
          resources: {}
        - args:
          - sh
          - -ec
          - |
            program_path=$(mktemp)
            printf "%s" "$0" > "$program_path"
            python3 -u "$program_path" "$@"
          - |
            def hello_world(text):
                print(text)
                return text

            import argparse
            _parser = argparse.ArgumentParser(prog='Hello world', description='')
            _parser.add_argument("--text", dest="text", type=str, required=True, default=argparse.SUPPRESS)
            _parsed_args = vars(_parser.parse_args())

            _outputs = hello_world(**_parsed_args)
          - --text
          - '{{$.inputs.parameters[''text'']}}'
          command:
          - /tekton/home/launch
          - --pipeline_name
          - namespace/n1/pipeline/hello-world
          - --run_id
          - $(params.run-id)
          - --execution_id
          - $(params.execution-id)
          - --executor_input
          - $(params.executor-input)
          - --component_spec
          - $(params.component-spec)
          - --pod_name
          - $(KFP_POD_NAME)
          - --pod_uid
          - $(KFP_POD_UID)
          - --mlmd_server_address
          - $(METADATA_GRPC_SERVICE_HOST)
          - --mlmd_server_port
          - $(METADATA_GRPC_SERVICE_PORT)
          - --
          env:
          - name: KFP_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: KFP_POD_UID
            valueFrom:
              fieldRef:
                fieldPath: metadata.uid
          - name: METADATA_GRPC_SERVICE_HOST
            value: metadata-grpc-service.kubeflow.svc.cluster.local
          - name: METADATA_GRPC_SERVICE_PORT
            value: "8080"
          envFrom:
          - configMapRef:
              name: metadata-grpc-configmap
              optional: true
          image: python:3.7
          name: user-main
          resources: {}
      when:
      - input: $(tasks.hello-world-driver.results.cached-decision)
        operator: in
        values:
        - "false"
    - name: root-system-dag-driver
      params:
      - name: type
        value: ROOT_DAG
      - name: pipeline_name
        value: namespace/n1/pipeline/hello-world
      - name: run_id
        value: $(context.pipelineRun.uid)
      - name: dag_execution_id
        value: "0"
      - name: component
        value: '{"dag":{"tasks":{"hello-world":{"cachingOptions":{"enableCache":true},"componentRef":{"name":"comp-hello-world"},"inputs":{"parameters":{"text":{"componentInputParameter":"text"}}},"taskInfo":{"name":"hello-world"}}}},"inputDefinitions":{"parameters":{"text":{"type":"STRING"}}}}'
      - name: task
        value: ""
      - name: runtime_config
        value: '{"parameters":{"text":{"stringValue":"hi there"}}}'
      - name: iteration_index
        value: "-1"
      taskRef:
        apiVersion: kfp-driver.tekton.dev/v1alpha1
        kind: KFPDriver
        name: kfp-driver
    - name: root-system-dag-pub-driver
      params:
      - name: type
        value: DAG-PUB
      - name: pipeline_name
        value: namespace/n1/pipeline/hello-world
      - name: run_id
        value: $(context.pipelineRun.uid)
      - name: dag_execution_id
        value: $(tasks.root-system-dag-driver.results.execution-id)
      runAfter:
      - hello-world
      taskRef:
        apiVersion: kfp-driver.tekton.dev/v1alpha1
        kind: KFPDriver
        name: kfp-driver
status: {}
