apiVersion: custom.tekton.dev/v1alpha1
kind: BreakTask
metadata:
  name: break-task
---
apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  annotations:
    tekton.dev/example-loop-pipeline: '{"spec":{"pipelineSpec":{"params":[{"name":"message","type":"string"}],"tasks":[{"name":"echo-loop-task","params":[{"name":"message","value":"$(params.message)"}],"taskSpec":{"params":[{"name":"message","type":"string"}],"steps":[{"name":"echo","image":"ubuntu","imagePullPolicy":"IfNotPresent","script":"#!/usr/bin/env bash\necho \"$(params.message)\"\n"}]}}]},"iterateParam":"message"}}'
  name: pr-loop-example
  labels:
    mylooplabels: mylooplabels
spec:
  pipelineSpec:
    tasks:
      - name: first-task
        taskSpec:
          steps:
            - name: echo
              image: ubuntu
              imagePullPolicy: IfNotPresent
              script: |
                #!/usr/bin/env bash
                echo "I am the first task before the loop task"
      - name: pipelineloop-break-operation
        runAfter:
          - first-task
        taskRef:
          apiVersion: custom.tekton.dev/v1alpha1
          kind: BreakTask
          name: break-task
      - name: last-task
        runAfter:
          - pipelineloop-break-operation
        taskSpec:
          steps:
            - name: echo
              image: ubuntu
              imagePullPolicy: IfNotPresent
              script: |
                #!/usr/bin/env bash
                echo "I am the last task after the loop task"
